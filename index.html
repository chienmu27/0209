<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>繳費查詢</title>

<style>
:root{
  --bg1:#e9f8ff;
  --bg2:#f7fbff;
  --card:#ffffffcc;
  --card2:#ffffffef;
  --text:#1f2d3d;
  --muted:#52657a;

  --primary:#1ea7ff;
  --primary2:#00d2ff;
  --accent:#34c759;

  --shadow: 0 18px 40px rgba(0,0,0,.10);
  --shadow2: 0 10px 20px rgba(0,0,0,.08);

  --radius: 20px;
}

*{ box-sizing:border-box; }

body{
  font-family: "Microsoft JhengHei", system-ui, -apple-system, "Segoe UI", sans-serif;
  margin: 0;
  padding: 24px;
  min-height: 100vh;
  color: var(--text);

  /* 可愛羽球背景：天空漸層 + 球場線條 + 羽球小圖案 */
  background:
    radial-gradient(circle at 12% 18%, rgba(30,167,255,.22), transparent 45%),
    radial-gradient(circle at 85% 25%, rgba(52,199,89,.18), transparent 40%),
    radial-gradient(circle at 30% 85%, rgba(0,210,255,.16), transparent 45%),

    /* 球場線條（淡淡的） */
    repeating-linear-gradient(
      90deg,
      rgba(30,167,255,.08) 0px,
      rgba(30,167,255,.08) 2px,
      transparent 2px,
      transparent 56px
    ),
    repeating-linear-gradient(
      0deg,
      rgba(30,167,255,.07) 0px,
      rgba(30,167,255,.07) 2px,
      transparent 2px,
      transparent 56px
    ),

    linear-gradient(180deg, var(--bg1), var(--bg2));
}

/* 整體置中容器 */
.wrap{
  max-width: 880px;
  margin: 0 auto;
}

/* 上方標題卡 */
.hero{
  position: relative;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
  box-shadow: var(--shadow);
  padding: 18px 18px 16px;
  overflow: hidden;
}

/* 右上角裝飾羽球（純 CSS） */
.hero::after{
  content:"";
  position:absolute;
  right:-10px;
  top:-10px;
  width: 130px;
  height: 130px;
  opacity:.18;
  background:
    radial-gradient(circle at 45% 35%, #1ea7ff 0 26px, transparent 27px),
    radial-gradient(circle at 45% 35%, #ffffff 0 18px, transparent 19px),
    conic-gradient(from 220deg, rgba(30,167,255,.9), rgba(0,210,255,.9), rgba(52,199,89,.8), rgba(30,167,255,.9));
  filter: blur(.2px);
  border-radius: 50%;
  transform: rotate(10deg);
}

/* 標題列 */
.titleRow{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 14px;
  flex-wrap: wrap;
}

h2{
  margin: 0;
  font-size: 22px;
  letter-spacing: .5px;
  display:flex;
  align-items:center;
  gap: 10px;
}

/* 小羽球 icon */
.shuttleIcon{
  width: 26px;
  height: 26px;
  display:inline-grid;
  place-items:center;
  border-radius: 12px;
  background: linear-gradient(135deg, rgba(30,167,255,.18), rgba(52,199,89,.15));
  box-shadow: 0 10px 18px rgba(0,0,0,.06);
  position: relative;
  overflow: hidden;
}

.shuttleIcon svg{
  width: 18px;
  height: 18px;
}

/* tab 區（帶羽球動畫） */
.tabs{
  display:flex;
  gap: 10px;
  align-items:center;
}

.tab{
  position: relative;
  padding: 9px 14px 9px 12px;
  border-radius: 999px;
  font-size: 14px;
  font-weight: 700;
  color: #0d3a57;
  background: rgba(30,167,255,.12);
  border: 1px solid rgba(30,167,255,.22);
  box-shadow: 0 10px 18px rgba(0,0,0,.06);
  display:flex;
  align-items:center;
  gap: 8px;
  user-select:none;
}

.tab .miniShuttle{
  width: 18px;
  height: 18px;
  display:inline-block;
  animation: shuttleSpin 1.5s ease-in-out infinite;
  transform-origin: 50% 50%;
  opacity:.95;
}

@keyframes shuttleSpin{
  0%{ transform: translateY(0) rotate(0deg); }
  50%{ transform: translateY(-3px) rotate(25deg); }
  100%{ transform: translateY(0) rotate(0deg); }
}

/* 主卡片 */
.card{
  margin-top: 14px;
  border-radius: var(--radius);
  background: var(--card2);
  box-shadow: var(--shadow2);
  padding: 18px;
  border: 1px solid rgba(255,255,255,.6);
}

/* 表單區 */
.formRow{
  display:flex;
  gap: 14px;
  align-items: flex-end;
  flex-wrap: wrap;
}

label{
  font-size: 14px;
  color: var(--muted);
  font-weight: 700;
}

.selectBox{
  min-width: 240px;
  flex: 1;
}

select{
  width: 100%;
  font-size: 16px;
  padding: 10px 12px;
  margin-top: 8px;
  border-radius: 14px;
  border: 1px solid rgba(31,45,61,.18);
  background: rgba(255,255,255,.95);
  outline: none;
  transition: .18s ease;
  box-shadow: 0 10px 18px rgba(0,0,0,.05);
}

select:focus{
  border-color: rgba(30,167,255,.55);
  box-shadow: 0 0 0 4px rgba(30,167,255,.15);
}

/* 按鈕（小羽球 icon + hover 飛翔） */
.btn{
  position: relative;
  border: none;
  cursor: pointer;
  border-radius: 16px;
  padding: 11px 14px;
  font-size: 15px;
  font-weight: 800;
  color: #fff;
  background: linear-gradient(135deg, var(--primary), var(--primary2));
  box-shadow: 0 14px 26px rgba(30,167,255,.25);
  display:flex;
  align-items:center;
  gap: 10px;
  transition: transform .18s ease, box-shadow .18s ease;
  user-select:none;
}

.btn:active{
  transform: translateY(1px);
}

/* hover: 羽球飛翔 */
.btn:hover{
  transform: translateY(-2px);
  box-shadow: 0 18px 34px rgba(30,167,255,.32);
}

.btn .btnShuttle{
  width: 18px;
  height: 18px;
  display:inline-block;
  transition: transform .25s ease;
}

.btn:hover .btnShuttle{
  transform: translateX(8px) translateY(-4px) rotate(20deg);
}

/* hover 飛翔軌跡 */
.btn::after{
  content:"";
  position:absolute;
  inset: 0;
  border-radius: 16px;
  pointer-events:none;
  opacity:0;
  background:
    radial-gradient(circle at 25% 60%, rgba(255,255,255,.35), transparent 35%),
    radial-gradient(circle at 60% 35%, rgba(255,255,255,.25), transparent 40%),
    radial-gradient(circle at 78% 70%, rgba(255,255,255,.18), transparent 45%);
  transform: translateX(-8px);
  transition: .25s ease;
}

.btn:hover::after{
  opacity: 1;
  transform: translateX(0);
}

/* 繳費狀態 */
#payStatus{
  margin-top: 14px;
  font-size: 18px;
  font-weight: 900;
  display:inline-flex;
  align-items:center;
  gap: 10px;
  padding: 10px 14px;
  border-radius: 999px;
  border: 1px solid rgba(31,45,61,.12);
  background: rgba(255,255,255,.92);
  box-shadow: 0 10px 18px rgba(0,0,0,.05);
}

.badgeDot{
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #ff3b30;
  box-shadow: 0 0 0 4px rgba(255,59,48,.12);
}

.paid .badgeDot{
  background: #34c759;
  box-shadow: 0 0 0 4px rgba(52,199,89,.14);
}

/* 表格 */
table{
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
  background: rgba(255,255,255,.9);
  margin-top: 14px;
  overflow: hidden;
  border-radius: 18px;
  box-shadow: 0 12px 22px rgba(0,0,0,.06);
  border: 1px solid rgba(31,45,61,.10);
}

th, td{
  padding: 11px 10px;
  text-align: center;
  font-size: 15px;
  border-bottom: 1px solid rgba(31,45,61,.08);
}

th{
  background: linear-gradient(180deg, rgba(30,167,255,.14), rgba(30,167,255,.06));
  font-weight: 900;
  color: #0d3a57;
}

tbody tr:hover td{
  background: rgba(30,167,255,.06);
}

tbody tr:last-child td{
  border-bottom: none;
}

/* RWD */
@media (max-width: 520px){
  body{ padding: 16px; }
  h2{ font-size: 20px; }
  .card{ padding: 14px; }
  .btn{ width: 100%; justify-content:center; }
  .selectBox{ width: 100%; }
}
</style>
</head>

<body>
  <div class="wrap">

    <div class="hero">
      <div class="titleRow">
        <h2>
          <span class="shuttleIcon" aria-hidden="true">
            <!-- 小羽球 icon -->
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M14.6 3.2c-1.6 1.6-1.4 4.1.4 5.9l1.2 1.2c1.8 1.8 4.3 2 5.9.4"
                    stroke="#1ea7ff" stroke-width="2" stroke-linecap="round"/>
              <path d="M12.2 5.6 6.2 11.6c-2.6 2.6-2.6 6.9 0 9.5"
                    stroke="#34c759" stroke-width="2" stroke-linecap="round"/>
              <path d="M7.2 21.1c2.6-2.6 6.9-2.6 9.5 0"
                    stroke="#34c759" stroke-width="2" stroke-linecap="round"/>
              <path d="M8.2 14.2l3.6 3.6M10.2 12.2l3.6 3.6M12.2 10.2l3.6 3.6"
                    stroke="#1f2d3d" stroke-opacity=".45" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          繳費查詢
        </h2>

        <div class="tabs">
          <div class="tab">
            <span class="miniShuttle" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M14.6 3.2c-1.6 1.6-1.4 4.1.4 5.9l1.2 1.2c1.8 1.8 4.3 2 5.9.4"
                      stroke="#1ea7ff" stroke-width="2" stroke-linecap="round"/>
                <path d="M12.2 5.6 6.2 11.6c-2.6 2.6-2.6 6.9 0 9.5"
                      stroke="#34c759" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            羽球查詢模式
          </div>
        </div>
      </div>
    </div>

    <div class="card">

      <div class="formRow">
        <div class="selectBox">
          <label>選擇學生：</label>
          <select id="studentSelect">
            <option value="">--請選擇--</option>
          </select>
        </div>

        <!-- 這顆按鈕不影響功能，只是外觀與互動 -->
        <button class="btn" type="button" onclick="document.getElementById('studentSelect').focus()">
          <span class="btnShuttle" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M14.6 3.2c-1.6 1.6-1.4 4.1.4 5.9l1.2 1.2c1.8 1.8 4.3 2 5.9.4"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round"/>
              <path d="M12.2 5.6 6.2 11.6c-2.6 2.6-2.6 6.9 0 9.5"
                    stroke="#ffffff" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          快速選擇
        </button>
      </div>

      <div id="payStatus" style="display:none;">
        <span class="badgeDot"></span>
        <span class="statusText"></span>
      </div>

      <table id="resultTable">
        <thead></thead>
        <tbody></tbody>
      </table>

    </div>
  </div>

<script>
// ====== CSV 連結（GitHub Pages 可直接讀取）======
const csvUrl =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vS0tI5Jlr-JGfZEZ1_DBIQQ-bTZ1g1I6uggZj7J3ZhgF5wQiv1EP2HI96CbC4o6CpsFWAeVB9A2SYm7/pub?gid=0&single=true&output=csv";

let rows = [];
let header = [];

// ====== CSV 解析 ======
function parseCSV(text) {
  const result = [];
  let cur = [];
  let curVal = "";
  let inQuotes = false;

  for (let i = 0; i < text.length; i++) {
    const ch = text[i];
    const next = text[i + 1];

    if (inQuotes) {
      if (ch === '"' && next === '"') {
        curVal += '"';
        i++;
      } else if (ch === '"') {
        inQuotes = false;
      } else {
        curVal += ch;
      }
    } else {
      if (ch === '"') {
        inQuotes = true;
      } else if (ch === ',') {
        cur.push(curVal);
        curVal = "";
      } else if (ch === '\n') {
        cur.push(curVal);
        result.push(cur);
        cur = [];
        curVal = "";
      } else if (ch !== '\r') {
        curVal += ch;
      }
    }
  }
  if (curVal !== "" || cur.length > 0) {
    cur.push(curVal);
    result.push(cur);
  }
  return result;
}

// ====== 載入 CSV ======
async function loadCSV() {
  const res = await fetch(csvUrl);
  const text = await res.text();
  const parsed = parseCSV(text);

  rows = parsed.filter(r => r.some(c => c && String(c).trim() !== ""));
  header = rows[0];

  buildStudentDropdown();
}

// ====== 建立學生選單（改為 A2:A） ======
function buildStudentDropdown() {
  const set = new Set();

  // A欄 = index 0，從第2列開始
  rows.slice(1).forEach(r => {
    const name = String(r[0] ?? "").trim();
    if (name) set.add(name);
  });

  const select = document.getElementById("studentSelect");
  select.innerHTML = '<option value="">--請選擇--</option>';

  [...set].sort().forEach(name => {
    const op = document.createElement("option");
    op.value = name;
    op.textContent = name;
    select.appendChild(op);
  });
}

// ====== 篩選學生資料（依欄位名稱：姓名） ======
function filterData(studentName) {
  const idxName = header.indexOf("姓名");
  if (idxName === -1) return [];
  return rows.slice(1).filter(r => String(r[idxName] ?? "").trim() === studentName);
}

// ====== 繳費狀態判斷 ======
function renderPayStatus(data) {
  const statusDiv = document.getElementById("payStatus");
  const dot = statusDiv.querySelector(".badgeDot");
  const text = statusDiv.querySelector(".statusText");

  statusDiv.classList.remove("paid");
  statusDiv.style.display = "none";
  text.textContent = "";

  const payIdx = header.indexOf("繳費情況");
  if (payIdx === -1) return;

  const hasPaid = data.some(r => String(r[payIdx] ?? "").trim() === "已繳費");

  statusDiv.style.display = "inline-flex";
  statusDiv.classList.toggle("paid", hasPaid);
  text.textContent = hasPaid ? "已繳費" : "未繳費";
}

// ====== 顯示表格（姓名、項目、繳費情況） ======
function renderTable(data) {
  const thead = document.querySelector("#resultTable thead");
  const tbody = document.querySelector("#resultTable tbody");
  thead.innerHTML = "";
  tbody.innerHTML = "";

  if (data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="3">沒有找到資料</td></tr>`;
    return;
  }

  const idxName = header.indexOf("姓名");
  const idxType = header.indexOf("類別");     // 顯示為「項目」
  const idxPay  = header.indexOf("繳費情況");

  thead.innerHTML = `
    <tr>
      <th>姓名</th>
      <th>項目</th>
      <th>繳費情況</th>
    </tr>
  `;

  data.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r[idxName] ?? ""}</td>
      <td>${r[idxType] ?? ""}</td>
      <td>${r[idxPay] ?? ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

// ====== 下拉選單監聽 ======
document.getElementById("studentSelect").addEventListener("change", e => {
  const student = e.target.value;
  const data = filterData(student);

  renderPayStatus(data);
  renderTable(data);
});

// ====== 初始化 ======
loadCSV();
</script>

</body>
</html>
